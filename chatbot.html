<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡§¨‡•à‡§Ç‡§ï ‡§ö‡•à‡§ü‡§¨‡•â‡§ü</title>
    <style>
        :root {
            --primary-color: #4caf50; /* Green */
            --secondary-color: #f0f2f5; /* Light grey background */
            --user-message-bg: #dcf8c6; /* Light green */
            --bot-message-bg: #ffffff; /* White */
            --text-dark: #333333;
            --text-light: #555555;
            --border-color: #dddddd;
            --suggestion-bg: #e9f5e9;
            --suggestion-hover-bg: #c8e6c9;
            --header-height: 60px;
            --input-area-height: 60px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
            font-family: Arial, sans-serif;
            background-color: var(--secondary-color);
            overflow: hidden; /* Prevent body scroll */
        }

        .chat-container {
            display: flex;
            flex-direction: column;
            height: 100%; /* Full height */
            width: 100%; /* Full width */
            max-width: 800px; /* Max width for larger screens */
            margin: 0 auto; /* Center on larger screens */
            background: var(--bot-message-bg);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-radius: 0; /* No radius for full screen */
        }
        @media (min-width: 801px) {
             .chat-container {
                 height: 90vh; /* Slightly less height on desktop */
                 max-height: 750px;
                 margin: 20px auto;
                 border-radius: 10px;
             }
        }

        .chat-header {
            height: var(--header-height);
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3em;
            font-weight: bold;
            padding: 0 20px;
            flex-shrink: 0; /* Prevent header from shrinking */
            border-top-left-radius: inherit; /* Inherit from container */
            border-top-right-radius: inherit;
        }
        .chat-header .icon {
            margin-right: 10px;
            font-size: 1.5em; /* Adjust icon size */
        }

        .chat-messages {
            flex-grow: 1; /* Take available space */
            padding: 15px 10px;
            overflow-y: auto; /* Enable scrolling ONLY for messages */
            background-color: var(--secondary-color);
            display: flex;
            flex-direction: column;
            gap: 10px; /* Space between messages */
        }

        .message {
            padding: 10px 15px;
            border-radius: 18px;
            line-height: 1.5;
            word-wrap: break-word;
            max-width: 85%;
            position: relative;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            font-size: 0.95em;
        }
        /* Basic link styling */
        .message a {
            color: #0066cc;
            text-decoration: underline;
        }
        .message a:hover {
             color: #004c99;
        }
        /* Paragraphs inside message */
        .message p {
            margin-bottom: 8px;
        }
        .message p:last-child {
            margin-bottom: 0;
        }
        /* Lists inside message */
        .message ul, .message ol {
            margin-left: 20px;
            margin-bottom: 8px;
        }


        .user {
            align-self: flex-end;
            background-color: var(--user-message-bg);
            color: var(--text-dark);
            border-bottom-right-radius: 6px;
        }

        .bot {
            align-self: flex-start;
            background-color: var(--bot-message-bg);
            color: var(--text-dark);
            border: 1px solid #f0f0f0;
            border-bottom-left-radius: 6px;
        }
        .bot.typing {
            color: var(--text-light);
            font-style: italic;
            background-color: transparent;
            border: none;
            box-shadow: none;
        }

        /* Suggestions IN CHAT */
         .suggestion-group {
             background-color: var(--bot-message-bg);
             border: 1px solid var(--border-color);
             padding: 15px;
             margin-top: 5px;
             border-radius: 15px;
             align-self: flex-start; /* Align like bot messages */
             max-width: 85%;
         }
         .suggestion-group .group-title {
             font-weight: bold;
             margin-bottom: 12px;
             color: var(--text-light);
             font-size: 0.9em;
         }
         .chat-suggestion {
             display: block;
             background-color: var(--suggestion-bg);
             color: var(--primary-color);
             padding: 10px 14px;
             border-radius: 8px;
             cursor: pointer;
             font-size: 0.9em;
             margin-bottom: 6px;
             border: 1px solid #d0e0d0;
             transition: background-color 0.2s ease, border-color 0.2s ease;
             text-align: left;
             font-weight: 500;
         }
         .chat-suggestion:hover {
             background-color: var(--suggestion-hover-bg);
             border-color: #b0c0b0;
         }
         .chat-suggestion:last-child {
             margin-bottom: 0;
         }

        /* Input Area */
        .chat-input-area { /* Renamed container */
            height: var(--input-area-height);
            display: flex;
            align-items: center; /* Center items vertically */
            border-top: 1px solid var(--border-color);
            background-color: #ffffff;
            padding: 8px 10px; /* Padding around input/button */
            flex-shrink: 0; /* Prevent input area from shrinking */
            position: relative; /* For suggestions box positioning */
        }
        .chat-input-area input {
            flex-grow: 1;
            height: 100%;
            padding: 0 15px; /* Padding inside input */
            border: 1px solid var(--border-color);
            border-radius: 20px; /* Rounded input */
            font-size: 1em;
            outline: none;
            margin-right: 8px; /* Space between input and button */
        }
        .chat-input-area input:focus {
             border-color: var(--primary-color);
             box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
        }

        .chat-input-area button {
            height: 100%;
            padding: 0 20px;
            border: none;
            background: var(--primary-color);
            color: white;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            border-radius: 20px; /* Rounded button */
            transition: background-color 0.2s ease;
        }
        .chat-input-area button:hover {
            background: #45a049; /* Darker green */
        }

        /* Suggestions ABOVE input */
        .suggestions {
            position: absolute;
            bottom: calc(var(--input-area-height) + 5px); /* Position above input area */
            left: 10px; /* Align with input area padding */
            right: 10px; /* Align with input area padding */
            display: flex;
            flex-direction: column;
            gap: 5px;
            padding: 10px;
            background: #ffffff;
            border: 1px solid var(--border-color);
            max-height: 200px; /* More height for suggestions */
            overflow-y: auto;
            z-index: 100; /* Ensure suggestions are on top */
            box-shadow: 0 -3px 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        .suggestion {
            background: #f1f1f1;
            color: var(--text-dark);
            padding: 10px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            text-align: left;
            border: 1px solid transparent;
            transition: background-color 0.2s ease;
        }
        .suggestion:hover {
           background: #e0e0e0;
        }

    </style>
</head>
<body>

<div class="chat-container">
    <div class="chat-header">
        <span class="icon">üè¶</span> Bank chatbot üí¨
    </div>
    <div class="chat-messages" id="chat">
        <div class="message bot">
            ‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç ‡§¨‡•à‡§Ç‡§ï ‡§ï‡§Æ‡•ç‡§Ø‡•Å‡§®‡§ø‡§ü‡•Ä ‡§≤‡•ã‡§® ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡•á ‡§∏‡§µ‡§æ‡§≤‡•ã‡§Ç ‡§ï‡§æ ‡§ú‡§µ‡§æ‡§¨ ‡§¶‡•á‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ø‡§π‡§æ‡§Å ‡§π‡•Ç‡§Å‡•§ ‡§Ü‡§™ ‡§Ö‡§™‡§®‡§æ ‡§∏‡§µ‡§æ‡§≤ ‡§®‡•Ä‡§ö‡•á ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§
        </div>
    </div>
    <div class="suggestions" id="suggestions" style="display:none;"></div>
    <div class="chat-input-area">
        <input id="input" type="text" placeholder="‡§Ö‡§™‡§®‡§æ ‡§∏‡§µ‡§æ‡§≤ ‡§Ø‡§π‡§æ‡§Å ‡§≤‡§ø‡§ñ‡•á‡§Ç..." oninput="showSuggestions(this.value)" onkeyup="handleKey(event)" autocomplete="off">
        <button onclick="send()" aria-label="‡§≠‡•á‡§ú‡•á‡§Ç">‡§≠‡•á‡§ú‡•á‡§Ç</button>
    </div>
</div>

<script>
    // --- API Key ---
    // !!! ‡§Ö‡§§‡•ç‡§Ø‡§Ç‡§§ ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§ö‡•á‡§§‡§æ‡§µ‡§®‡•Ä !!!
    // ‡§Ø‡§π API ‡§ï‡•Å‡§Ç‡§ú‡•Ä ‡§∏‡§æ‡§∞‡•ç‡§µ‡§ú‡§®‡§ø‡§ï ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§ú‡•ç‡§û‡§æ‡§§ ‡§π‡•à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§á‡§∏‡•á ‡§§‡•Å‡§∞‡§Ç‡§§ Google Cloud Console ‡§Æ‡•á‡§Ç
    // ‡§®‡§ø‡§∑‡•ç‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§è‡§ï ‡§®‡§à, ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡•Å‡§Ç‡§ú‡•Ä ‡§¨‡§®‡§æ‡§è‡§Ç‡•§ ‡§á‡§∏ ‡§ï‡•Å‡§Ç‡§ú‡•Ä ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ú‡§æ‡§∞‡•Ä ‡§∞‡§ñ‡§®‡•á ‡§∏‡•á
    // ‡§Ü‡§™‡§ï‡•á ‡§ñ‡§æ‡§§‡•á ‡§ï‡§æ ‡§¶‡•Å‡§∞‡•Å‡§™‡§Ø‡•ã‡§ó ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ ‡§π‡•à ‡§î‡§∞ ‡§Ö‡§®‡§™‡•á‡§ï‡•ç‡§∑‡§ø‡§§ ‡§∂‡•Å‡§≤‡•ç‡§ï ‡§≤‡§ó ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§
    // ‡§á‡§∏ ‡§°‡•á‡§Æ‡•ã ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à, ‡§≤‡•á‡§ï‡§ø‡§® ‡§Ø‡§π ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§§‡•ç‡§Ø‡§Ç‡§§ ‡§Ö‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§π‡•à‡•§
    const API_KEY = "AIzaSyBwhJNl7Rw4Xwb8esmsIes5uVX2fWlRnSE";

    // 1. Hardcoded data segments (Knowledge Base for Context)
    const dataSegments = [
  {
    "question": "bank community loan kya hai?",
    "answer": "‡§¨‡•à‡§Ç‡§ï ‡§ï‡§Æ‡•ç‡§Ø‡•Å‡§®‡§ø‡§ü‡•Ä ‡§≤‡•ã‡§® ‡§è‡§ï ‡§¨‡§ö‡§§ ‡§î‡§∞ ‡§ã‡§£ ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§π‡•à, ‡§ú‡•ã ‡§õ‡•ã‡§ü‡•á ‡§∏‡§Æ‡•Å‡§¶‡§æ‡§Ø ‡§ï‡•á ‡§∏‡§¶‡§∏‡•ç‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§î‡§∞ ‡§∏‡§π‡§Ø‡•ã‡§ó ‡§™‡§∞ ‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§Ü‡§∞‡•ç‡§•‡§ø‡§ï ‡§Æ‡§¶‡§¶ ‡§™‡§π‡•Å‡§Ç‡§ö‡§æ‡§§‡•Ä ‡§π‡•à‡•§"
  },
  {
    "question": "ye yojana kaise kaam karti hai?",
    "answer": "‡§∏‡§¶‡§∏‡•ç‡§Ø‡§§‡§æ ‡§≤‡•á‡§ï‡§∞ ‡§Ü‡§™ ‡§π‡§∞ ‡§Æ‡§π‡•Ä‡§®‡•á ‡§è‡§ï ‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§∞‡§æ‡§∂‡§ø SIP (‡§™‡§π‡§≤‡•á EMI) ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§ú‡§Æ‡§æ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§ú‡§¨ ‡§Ü‡§™‡§ï‡•ã ‡§ú‡§∞‡•Ç‡§∞‡§§ ‡§π‡•ã‡§§‡•Ä ‡§π‡•à, ‡§Ü‡§™ ‡§ú‡§Æ‡§æ ‡§∞‡§æ‡§∂‡§ø ‡§ï‡•á ‡§Ö‡§®‡•Å‡§™‡§æ‡§§ ‡§Æ‡•á‡§Ç ‡§≤‡•ã‡§® ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§∏‡§≠‡•Ä ‡§∏‡§¶‡§∏‡•ç‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§π‡§Ø‡•ã‡§ó ‡§∏‡•á ‡§≤‡§ø‡§è ‡§ú‡§æ‡§§‡•á ‡§π‡•à‡§Ç‡•§"
  },
  {
    "question": "sip monthly emi ki rashi aur samay seema kya hai?",
    "answer": "‡§π‡§∞ ‡§Æ‡§π‡•Ä‡§®‡•á ‡§ï‡•Ä 1 ‡§∏‡•á 10 ‡§§‡§æ‡§∞‡•Ä‡§ñ ‡§ï‡•á ‡§¨‡•Ä‡§ö ‚Çπ500 SIP ‡§ú‡§Æ‡§æ ‡§ï‡§∞‡§®‡§æ ‡§Ö‡§®‡§ø‡§µ‡§æ‡§∞‡•ç‡§Ø ‡§π‡•à‡•§"
  },
  {
    "question": "sip bounce hone par kya hota hai?",
    "answer": "‡§Ø‡§¶‡§ø SIP 2‚Äì3 ‡§¨‡§æ‡§∞ ‡§¨‡§æ‡§â‡§Ç‡§∏ ‡§π‡•ã‡§§‡•Ä ‡§π‡•à, ‡§§‡•ã ‡§∏‡§¶‡§∏‡•ç‡§Ø‡§§‡§æ 1 ‡§µ‡§∞‡•ç‡§∑ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∞‡§¶‡•ç‡§¶ ‡§π‡•ã ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à‡•§"
  },
  {
    "question": "sadasyata radd hone par kya milega?",
    "answer": "‡§∏‡§¶‡§∏‡•ç‡§Ø‡§§‡§æ ‡§∞‡§¶‡•ç‡§¶ ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§Ü‡§™‡§ï‡•Ä ‡§ú‡§Æ‡§æ ‡§∞‡§æ‡§∂‡§ø ‡§≤‡•å‡§ü‡§æ‡§à ‡§ú‡§æ‡§è‡§ó‡•Ä, ‡§≤‡•á‡§ï‡§ø‡§® ‡§¨‡•ç‡§Ø‡§æ‡§ú ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•á‡§ó‡§æ‡•§"
  },
  {
    "question": "loan lene ke liye kya zaruri hai?",
    "answer": "‡§≤‡•ã‡§® ‡§≤‡•á‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§™‡§ï‡•ã ‡§≤‡•ã‡§® ‡§´‡•â‡§∞‡•ç‡§Æ ‡§≠‡§∞‡§®‡§æ ‡§π‡•ã‡§ó‡§æ ‡§î‡§∞ ‡§Ø‡§π ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ ‡§π‡•ã‡§ó‡§æ ‡§ï‡§ø ‡§Ü‡§™‡§ï‡§æ ‡§ï‡•ã‡§à ‡§¨‡§ï‡§æ‡§Ø‡§æ ‡§® ‡§π‡•ã‡•§"
  },
  {
    "question": "loan ki kist aur avadhi kaisi hogi?",
    "answer": "‡§≤‡•ã‡§® ‡§ï‡•Ä ‡§ï‡§ø‡§∏‡•ç‡§§ 31 ‡§¶‡§ø‡§®‡•ã‡§Ç ‡§ï‡•Ä ‡§π‡•ã‡§ó‡•Ä; ‡§¶‡•á‡§∞‡•Ä ‡§∏‡•á ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§™‡§∞ ‡§Ö‡§ó‡§≤‡•Ä ‡§ï‡§ø‡§∏‡•ç‡§§ ‡§Æ‡•á‡§Ç ‡§ú‡•Å‡§°‡§º ‡§ú‡§æ‡§è‡§ó‡§æ‡•§"
  },
  {
    "question": "free loan kya hai?",
    "answer": "Free Loan: ‡§Æ‡§π‡•Ä‡§®‡•á ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§¨‡§æ‡§∞ ‚Çπ1000 ‡§§‡§ï 5 ‡§¶‡§ø‡§®‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§≤‡•ã‡§® ‡§≤‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§ ‡§≤‡•á‡§ü ‡§´‡§æ‡§á‡§® ‚Çπ10 ‡§™‡•ç‡§∞‡§§‡§ø ‡§¶‡§ø‡§®‡•§"
  },
  {
    "question": "aap kitna loan le sakte hain?",
    "answer": "‡§Ü‡§™ ‡§ú‡§Æ‡§æ ‡§∞‡§æ‡§∂‡§ø ‡§ï‡§æ 1.5√ó ‡§§‡§ï ‡§≤‡•ã‡§® ‡§≤‡•á ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§Ø‡§¶‡§ø ‡§¶‡•ã‡§ó‡•Å‡§®‡§æ ‡§≤‡•ã‡§® ‡§≤‡•á‡§®‡§æ ‡§π‡•ã, ‡§§‡•ã 2% ‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§¨‡•ç‡§Ø‡§æ‡§ú ‡§¶‡•á‡§®‡§æ ‡§π‡•ã‡§ó‡§æ‡•§"
  },
  {
    "question": "late fine par byaj kaise lagu hoga?",
    "answer": "‡§Ø‡§¶‡§ø ‡§≤‡•ã‡§® 31 ‡§¶‡§ø‡§® ‡§∏‡•á ‡§Ö‡§ß‡§ø‡§ï ‡§∞‡§π‡§§‡§æ ‡§π‡•à, ‡§§‡•ã ‡§¨‡•ç‡§Ø‡§æ‡§ú ‡§Ö‡§ó‡§≤‡•á ‡§Æ‡§π‡•Ä‡§®‡•á ‡§Æ‡•á‡§Ç ‡§≤‡§æ‡§ó‡•Ç ‡§π‡•ã‡§ó‡§æ‡•§"
  },
  {
    "question": "loan kist der se hone par kya suchna deni hogi?",
    "answer": "‡§≤‡•ã‡§® ‡§ï‡§ø‡§∏‡•ç‡§§ ‡§¶‡•á‡§∞ ‡§∏‡•á ‡§ï‡§∞‡§®‡•á ‡§™‡§∞ SMS ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§∏‡•Ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ ‡§Ö‡§®‡§ø‡§µ‡§æ‡§∞‡•ç‡§Ø ‡§π‡•à; ‡§®‡§π‡•Ä‡§Ç ‡§§‡•ã ‚Çπ10 ‡§™‡•á‡§®‡§≤‡•ç‡§ü‡•Ä ‡§≤‡§ó‡•á‡§ó‡•Ä‡•§"
  },
  {
    "question": "kist bounce hone par kya hoga?",
    "answer": "‡§ï‡§ø‡§∏‡•ç‡§§ ‡§¨‡§æ‡§â‡§Ç‡§∏ ‡§π‡•ã‡§®‡•á ‡§î‡§∞ ‡§∏‡•Ç‡§ö‡§®‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§¶‡•á‡§®‡•á ‡§™‡§∞ 60 ‡§¶‡§ø‡§® ‡§§‡§ï ‡§≤‡•ã‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•á‡§ó‡§æ (‡§¶‡•ã ‡§¨‡§æ‡§∞ ‡§¨‡§æ‡§â‡§Ç‡§∏ ‡§™‡§∞)‡•§"
  },
  {
    "question": "emi par loan lene par kya sharten hain?",
    "answer": "EMI ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ ‡§™‡§∞ ‡§≤‡•ã‡§® ‡§™‡§∞ 8% ‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§¨‡•ç‡§Ø‡§æ‡§ú ‡§≤‡§ó‡•á‡§ó‡§æ ‡§î‡§∞ ‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ‡§Ö‡§µ‡§ß‡§ø 3 ‡§Æ‡§π‡•Ä‡§®‡•á ‡§π‡•ã‡§ó‡•Ä (‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ ‡§∞‡§æ‡§∂‡§ø ‚Çπ2500)‡•§"
  },
  {
    "question": "naya sadasya kaise judta hai?",
    "answer": "‡§®‡§Ø‡§æ ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§¨‡§®‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡§π‡•Ä‡§®‡•á ‡§ï‡•Ä ‡§∂‡•Å‡§∞‡•Å‡§Ü‡§§ (1‚Äì5 ‡§§‡§æ‡§∞‡•Ä‡§ñ) ‡§Æ‡•á‡§Ç ‚Çπ500 ‡§ú‡§Æ‡§æ ‡§ï‡§∞‡§®‡§æ ‡§π‡•ã‡§§‡§æ ‡§π‡•à; ‡§≤‡•ã‡§® ‡§ï‡•á‡§µ‡§≤ 60 ‡§¶‡§ø‡§® ‡§¨‡§æ‡§¶ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•ã‡§ó‡§æ‡•§"
  },
  {
    "question": "ek mahine ke loan par charge kya hai?",
    "answer": "1‚Äì31 ‡§¶‡§ø‡§® ‡§§‡§ï ‡§ï‡•á ‡§≤‡•ã‡§® ‡§™‡§∞ 1% ‡§ö‡§æ‡§∞‡•ç‡§ú ‡§π‡•ã‡§ó‡§æ‡•§"
  },
  {
    "question": "do mahine ke loan par penalty kya hai?",
    "answer": "32‚Äì60 ‡§¶‡§ø‡§® ‡§§‡§ï ‡§ï‡•á ‡§≤‡•ã‡§® ‡§™‡§∞ 3% ‡§™‡•á‡§®‡§≤‡•ç‡§ü‡•Ä ‡§≤‡§ó‡•á‡§ó‡•Ä‡•§"
  },
  {
    "question": "teen mahine ke loan par penalty kya hogi?",
    "answer": "61+ ‡§¶‡§ø‡§®‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è 5% ‡§™‡•á‡§®‡§≤‡•ç‡§ü‡•Ä (RED MEMBER) ‡§≤‡§æ‡§ó‡•Ç ‡§π‡•ã‡§ó‡•Ä‡•§"
  },
  {
    "question": "civil score kya hai?",
    "answer": "‚Çπ100 ‡§ú‡§Æ‡§æ ‡§ï‡§∞‡§®‡•á ‡§™‡§∞ 10 ‡§™‡•â‡§á‡§Ç‡§ü‡•ç‡§∏ ‡§∏‡§ø‡§µ‡§ø‡§≤ ‡§∏‡•ç‡§ï‡•ã‡§∞ ‡§Æ‡•á‡§Ç ‡§ú‡•Å‡§°‡§º‡§§‡•á ‡§π‡•à‡§Ç‡•§"
  },
  {
    "question": "loan payment aur punah loan lene ki shart?",
    "answer": "‡§ú‡§ø‡§∏ ‡§¶‡§ø‡§® ‡§Ü‡§™ ‡§≤‡•ã‡§® ‡§ï‡§æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç‡§ó‡•á, ‡§â‡§∏ ‡§¶‡§ø‡§® ‡§´‡§ø‡§∞ ‡§≤‡•ã‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•á‡§ó‡§æ; ‡§Ö‡§ó‡§≤‡•á ‡§¶‡§ø‡§® ‡§Ü‡§™ ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§≤‡•ã‡§® ‡§≤‡•á ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§"
  },
  {
    "question": " member exit kaise hoga?",
    "answer": "Exit ‡§ï‡•á ‡§≤‡§ø‡§è 60 ‡§¶‡§ø‡§® ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡§¶‡§∏‡•ç‡§Ø‡§§‡§æ ‡§π‡•ã‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è ‡§î‡§∞ ‡§´‡•â‡§∞‡•ç‡§Æ ‡§≠‡§∞‡§®‡§æ ‡§Ö‡§®‡§ø‡§µ‡§æ‡§∞‡•ç‡§Ø ‡§π‡•à; 1‚Äì10 ‡§§‡§æ‡§∞‡•Ä‡§ñ ‡§Æ‡•á‡§Ç ‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø ‡§è‡§µ‡§Ç ‡§¨‡•ç‡§Ø‡§æ‡§ú ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§π‡•ã‡§ó‡§æ‡•§ 60 ‡§¶‡§ø‡§® ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§®‡§ø‡§ï‡§≤‡•á ‡§™‡§∞ 10% ‡§ï‡§ü‡•å‡§§‡•Ä‡•§"
  },
  {
    "question": "board member kaun-kaun hain?",
    "answer": "Prime Members: Amit Kumar, Mithilesh Sahni, Prince Kumar. ‡§á‡§®‡•ç‡§π‡•á‡§Ç ‡§∏‡§Æ‡§Ø ‡§™‡§∞ ‡§ú‡§Æ‡§æ ‡§î‡§∞ ‡§ú‡§ø‡§Æ‡•ç‡§Æ‡•á‡§¶‡§æ‡§∞ ‡§µ‡•ç‡§Ø‡§µ‡§π‡§æ‡§∞ ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ ‡§ö‡•Å‡§®‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§"
  },
  {
    "question": "board member ki jimmedariyan kya hain?",
    "answer": "‡§∏‡§≠‡•Ä ‡§Ü‡§∞‡•ç‡§•‡§ø‡§ï ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§≠‡§æ‡§ó, ‡§≤‡•ã‡§® ‡§µ‡§ø‡§§‡§∞‡§£, ‡§´‡§Ç‡§° ‡§Æ‡•â‡§®‡§ø‡§ü‡§∞‡§ø‡§Ç‡§ó, ‡§®‡§è ‡§∏‡§¶‡§∏‡•ç‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ó‡§æ‡§∞‡§Ç‡§ü‡•Ä, ‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§ ‡§Æ‡•Ä‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏‡•§"
  },
  {
    "question": "board member banne ke niyam kya hain?",
    "answer": "‡§∏‡§Æ‡§Ø ‡§™‡§∞ ‡§ú‡§Æ‡§æ, ‡§ó‡§æ‡§∞‡§Ç‡§ü‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ, 70% ‡§∏‡§π‡§Æ‡§§‡§ø ‡§∏‡•á ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø, ‡§∏‡§ø‡§µ‡§ø‡§≤ ‡§∏‡•ç‡§ï‡•ã‡§∞ ‡§®‡•á‡§ó‡•á‡§ü‡§ø‡§µ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è‡•§"
  },
  {
    "question": "guarantor banne ke liye kya avashyaktaen hain?",
    "answer": "6 ‡§Æ‡§π‡•Ä‡§®‡•á ‡§∏‡•á ‡§∏‡§¶‡§∏‡•ç‡§Ø, ‡§∏‡§ø‡§µ‡§ø‡§≤ ‡§∏‡•ç‡§ï‡•ã‡§∞ ‚â•200, ‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§∏‡§Æ‡§ù‡•å‡§§‡§æ, ‡§§‡§Ø ‡§∂‡§∞‡•ç‡§§‡•ã‡§Ç ‡§ï‡§æ ‡§™‡§æ‡§≤‡§®‡•§"
  },
  {
    "question": "naye member jodne ki sharten kya hain?",
    "answer": "‡§ó‡§æ‡§∞‡§Ç‡§ü‡§∞ ‡§ï‡•Ä ‡§ó‡§æ‡§∞‡§Ç‡§ü‡•Ä, 1 ‡§Æ‡§π‡•Ä‡§®‡•á ‡§Ö‡§ó‡•ç‡§∞‡§ø‡§Æ ‡§ú‡§Æ‡§æ, ‡§™‡•É‡§∑‡•ç‡§†‡§≠‡•Ç‡§Æ‡§ø ‡§ú‡§æ‡§Å‡§ö ‡§Ö‡§®‡§ø‡§µ‡§æ‡§∞‡•ç‡§Ø‡•§"
  },
  {
    "question": "meeting aur paradarshita kaise sunishchit hoti hai?",
    "answer": "‡§π‡§∞ ‡§Æ‡§π‡•Ä‡§®‡•á ‡§Æ‡•Ä‡§ü‡§ø‡§Ç‡§ó ‡§Æ‡•á‡§Ç ‡§ú‡§Æ‡§æ/‡§≤‡•ã‡§® ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°, ‡§Æ‡•á‡§Ç‡§¨‡§∞ ‡§è‡§µ‡§Ç ‡§ó‡§æ‡§∞‡§Ç‡§ü‡§∞ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø, ‡§∏‡§Ç‡§∏‡•ç‡§•‡§æ ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§ó‡§§‡§ø ‡§™‡§∞ ‡§ö‡§∞‡•ç‡§ö‡§æ‡•§"
  },
  {
    "question": "loan website aur sthaapna ki jankari?",
    "answer": "Website: https://bank-community.github.io/Loan-from -- Estd: 23 June 2024"
  },
  {
    "question": "kya ek vyakti ek saath do loan le sakta hai?",
    "answer": "‡§Ø‡§¶‡§ø ‡§ï‡•ã‡§à ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§ú‡§Æ‡§æ ‡§∞‡§æ‡§∂‡§ø ‡§ï‡§æ 1.5 ‡§ó‡•Å‡§®‡§æ ‡§≤‡•ã‡§® ‡§≤‡•á ‡§ö‡•Å‡§ï‡§æ ‡§π‡•à ‡§î‡§∞ ‚Çπ1000 ‡§∏‡•á ‡§Ö‡§ß‡§ø‡§ï ‡§∞‡§æ‡§∂‡§ø ‡§∂‡•á‡§∑ ‡§π‡•à, ‡§§‡•ã ‡§µ‡§π ‚Çπ1000 ‡§§‡§ï ‡§ï‡§æ ‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§≤‡•ã‡§® ‡§≤‡•á ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§"
  },
  {
    "question": "loan chukane ke baad turant exit lena sambhav hai kya?",
    "answer": "‡§®‡§π‡•Ä‡§Ç, ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§ï‡•ã ‡§™‡§π‡§≤‡•á ‡§™‡•Ç‡§∞‡§æ ‡§≤‡•ã‡§® ‡§ö‡•Å‡§ï‡§æ‡§®‡§æ ‡§Ö‡§®‡§ø‡§µ‡§æ‡§∞‡•ç‡§Ø ‡§π‡•à‡•§ ‡§≤‡•ã‡§® ‡§ö‡•Å‡§ï‡§æ‡§è ‡§¨‡§ø‡§®‡§æ Exit ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§"
  },
  {
    "question": "bank community mein prime members kaun hain aur sanstha kaise chalti hai?",
    "answer": "Prime Members: Amit Kumar, Prince Kumar, Mithilesh Sahni. ‡§∏‡§Ç‡§∏‡•ç‡§•‡§æ WhatsApp Group ‡§î‡§∞ Website ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§∏‡§Ç‡§ö‡§æ‡§≤‡§ø‡§§ ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡•§ WhatsApp Group Link: https://chat.whatsapp.com/G39I0hP55WIDHMu5YkAjDZ"
  },
  {
    "question": "main bank community mein kaise join kar sakta hoon?",
    "answer": "‡§Ü‡§™ ‡§®‡•Ä‡§ö‡•á ‡§¶‡§ø‡§è ‡§ó‡§è ‡§≤‡§ø‡§Ç‡§ï ‡§™‡§∞ ‡§ú‡§æ‡§ï‡§∞ ‡§∏‡§¶‡§∏‡•ç‡§Ø‡§§‡§æ ‡§≤‡•á ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç: https://bank-community.github.io/Loan-from/newbank.html"
  }
]; // Ensure the full array is here

    const chatBox = document.getElementById("chat");
    const inputBox = document.getElementById("input");
    const suggestionsBox = document.getElementById("suggestions");

    /**
     * Appends a message to the chat box.
     * @param {string} text - The message text or HTML.
     * @param {string} cls - CSS class for the message bubble (e.g., 'user', 'bot').
     * @param {boolean} isHtml - Set to true if 'text' contains HTML to be rendered. Defaults to false.
     * @returns {HTMLElement} The created message element.
     */
    function appendMessage(text, cls, isHtml = false) {
        const d = document.createElement("div");
        d.className = "message " + cls;
        if (isHtml) {
            // Sanitize potentially harmful HTML here if needed in a real application
            d.innerHTML = text; // Use innerHTML only if flag is true
        } else {
            d.textContent = text; // Safer default
        }
        chatBox.appendChild(d);
        // Scroll smoothly to the bottom
        chatBox.scrollTo({ top: chatBox.scrollHeight, behavior: 'smooth' });
        return d;
    }

    /**
     * Finds URLs in text and converts them to clickable HTML links.
     * @param {string} text - The input text.
     * @returns {string} Text with URLs converted to <a> tags.
     */
    function linkify(text) {
        // More robust regex for URLs (handles various protocols and paths)
        const urlRegex = /(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])|(\bwww\.[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;
        return text.replace(urlRegex, function(url) {
            let fullUrl = url;
            if (!fullUrl.match(/^https?:\/\//i)) {
                 fullUrl = 'http://' + fullUrl; // Add http if missing (for www links)
            }
            // Ensure link text itself doesn't contain HTML tags to prevent breaking
            const linkText = url.replace(/</g, "&lt;").replace(/>/g, "&gt;");
            return `<a href="${fullUrl}" target="_blank" rel="noopener noreferrer">${linkText}</a>`;
        });
    }

     /**
     * Appends a group of clickable question suggestions within the chat.
     * @param {string} title - The title for the suggestion group.
     * @param {string[]} questions - An array of question strings to suggest.
     */
     function appendSuggestionGroup(title, questions) {
        const groupDiv = document.createElement("div");
        groupDiv.className = "message bot suggestion-group"; // Use bot style + suggestion group

        const titleDiv = document.createElement("div");
        titleDiv.className = "group-title";
        titleDiv.textContent = title;
        groupDiv.appendChild(titleDiv);

        questions.forEach(q_text => {
            const suggestionEl = document.createElement("div");
            suggestionEl.className = "chat-suggestion";
            suggestionEl.textContent = q_text;
            suggestionEl.onclick = () => {
                inputBox.value = q_text; // Fill input
                suggestionsBox.style.display = 'none'; // Hide suggestions above input
                 // Remove suggestion group from chat maybe? Or leave it for history. Let's leave it.
                send(); // Send the selected question
            };
            groupDiv.appendChild(suggestionEl);
        });

        chatBox.appendChild(groupDiv);
        chatBox.scrollTo({ top: chatBox.scrollHeight, behavior: 'smooth' });
    }


    /**
     * Shows relevant question suggestions above the input field based on user typing.
     * @param {string} text - The text currently in the input field.
     */
    function showSuggestions(text) {
        // console.log("Input:", text); // Uncomment for debugging
        suggestionsBox.innerHTML = '';
        const lowInput = text.toLowerCase().trim();

        if (lowInput.length < 2) { // Don't show suggestions for very short input
            suggestionsBox.style.display = 'none';
            return;
        }

        const matches = new Set();
        dataSegments.forEach(seg => {
            if (seg.question.toLowerCase().includes(lowInput)) {
                matches.add(seg.question);
            }
        });

        // console.log("Matches:", matches.size); // Uncomment for debugging

        if (matches.size === 0) {
            suggestionsBox.style.display = 'none';
            return;
        }

        // Limit to 5 suggestions and create elements
        Array.from(matches).slice(0, 5).forEach(q_text => {
            const div = document.createElement('div');
            div.className = 'suggestion';
            div.textContent = q_text;
            div.onclick = () => {
                inputBox.value = q_text;
                suggestionsBox.style.display = 'none';
                send();
            };
            suggestionsBox.appendChild(div);
        });
        suggestionsBox.style.display = 'flex';
    }

    /**
     * Handles the Enter key press in the input field.
     * @param {Event} event - The keyup event object.
     */
    function handleKey(event) {
        if (event.key === 'Enter') {
            send();
        }
    }

   /**
    * Displays relevant question suggestions within the chat interface, typically after an unclear query.
    * @param {string} failedQuery - The user's query that didn't match local context well.
    */
   function displayErrorSuggestions(failedQuery = "") {
        const lowerFailedQuery = failedQuery.toLowerCase().trim();
        let potentialMatches = [];

        // Try to find questions partially related to the failed query
        if(lowerFailedQuery){
             potentialMatches = dataSegments.filter(seg =>
                seg.question.toLowerCase().includes(lowerFailedQuery) ||
                lowerFailedQuery.split(' ').some(word => word.length > 2 && seg.question.toLowerCase().includes(word)) // Check word overlap
            ).map(seg => seg.question);
        }

        // If not enough matches, add generic ones from the start
        const needed = 5 - potentialMatches.length;
        if (needed > 0) {
            const existing = new Set(potentialMatches);
            for (let i = 0; i < dataSegments.length && potentialMatches.length < 5; i++) {
                if (!existing.has(dataSegments[i].question)) {
                    potentialMatches.push(dataSegments[i].question);
                    existing.add(dataSegments[i].question);
                }
            }
        }

        const suggestionsToShow = potentialMatches.slice(0, 5);

        if (suggestionsToShow.length > 0) {
            // Use setTimeout to ensure suggestions appear after the main response animation might finish
            setTimeout(() => {
                appendSuggestionGroup("‡§Ü‡§™ ‡§∂‡§æ‡§Ø‡§¶ ‡§¨‡•à‡§Ç‡§ï ‡§ï‡§Æ‡•ç‡§Ø‡•Å‡§®‡§ø‡§ü‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§á‡§®‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§ï‡•ã‡§à ‡§∏‡§µ‡§æ‡§≤ ‡§™‡•Ç‡§õ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç:", suggestionsToShow);
            }, 200); // Small delay
        }
   }


    /**
     * Sends the user's query to the backend (API) and displays the response.
     */
    async function send() {
        const q = inputBox.value.trim();
        if (!q) return;

        if (!API_KEY || API_KEY === "YOUR_API_KEY" || API_KEY.length < 30) {
            appendMessage("‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: API ‡§ï‡•Å‡§Ç‡§ú‡•Ä ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à ‡§Ø‡§æ ‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§π‡•à‡•§", "bot");
            console.error("API Key is missing or invalid.");
            return;
        }

        appendMessage(q, "user");
        const currentQuery = q;
        inputBox.value = '';
        suggestionsBox.style.display = 'none';

        const typingIndicator = appendMessage("‡§∏‡•ã‡§ö ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Å...", "bot typing");

        // --- Determine Context and Prepare Prompt ---
        let context = "";
        let prompt = "";
        let useGeneralApi = false;

        const lowerQ = currentQuery.toLowerCase();
        // Slightly stricter matching for deciding context relevance
        const relevantSegments = dataSegments.filter(seg =>
            seg.question.toLowerCase().includes(lowerQ) ||
            (lowerQ.includes("bank") && seg.question.toLowerCase().includes(lowerQ.replace("bank",""))) // Simple attempt if 'bank' is generic
            // Add more sophisticated relevance logic if needed
        );

        if (relevantSegments.length > 0) {
            // --- CONTEXT FOUND ---
            context = "‡§™‡•ç‡§∞‡§æ‡§∏‡§Ç‡§ó‡§ø‡§ï ‡§¨‡•à‡§Ç‡§ï ‡§ï‡§Æ‡•ç‡§Ø‡•Å‡§®‡§ø‡§ü‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä:\n";
            relevantSegments.slice(0, 5).forEach(seg => { // Limit context size
                context += `‡§™‡•ç‡§∞‡§∂‡•ç‡§®: ${seg.question}\n‡§â‡§§‡•ç‡§§‡§∞: ${seg.answer}\n\n`;
            });

            prompt = `‡§Ü‡§™ '‡§¨‡•à‡§Ç‡§ï ‡§ï‡§Æ‡•ç‡§Ø‡•Å‡§®‡§ø‡§ü‡•Ä ‡§ö‡•à‡§ü‡§¨‡•â‡§ü' ‡§π‡•à‡§Ç, ‡§è‡§ï ‡§™‡•á‡§∂‡•á‡§µ‡§∞ ‡§î‡§∞ ‡§∏‡§π‡§æ‡§Ø‡§ï AI‡•§ ‡§Ü‡§™‡§ï‡§æ ‡§ï‡§æ‡§Æ ‡§¨‡•à‡§Ç‡§ï ‡§ï‡§Æ‡•ç‡§Ø‡•Å‡§®‡§ø‡§ü‡•Ä ‡§≤‡•ã‡§® ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§µ‡§æ‡§≤‡•ã‡§Ç ‡§ï‡•á ‡§ú‡§µ‡§æ‡§¨ ‡§¶‡•á‡§®‡§æ ‡§π‡•à‡•§
            ‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂:
            1.  ‡§®‡•Ä‡§ö‡•á ‡§¶‡§ø‡§è ‡§ó‡§è '‡§™‡•ç‡§∞‡§æ‡§∏‡§Ç‡§ó‡§ø‡§ï ‡§¨‡•à‡§Ç‡§ï ‡§ï‡§Æ‡•ç‡§Ø‡•Å‡§®‡§ø‡§ü‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä' ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•á ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§ï‡§æ ‡§∏‡§ü‡•Ä‡§ï ‡§î‡§∞ ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•á‡§Ç‡•§
            2.  ‡§â‡§§‡•ç‡§§‡§∞ ‡§ï‡•á‡§µ‡§≤ ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§ø‡§è ‡§ó‡§è ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ ‡§™‡§∞ ‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è‡•§ ‡§Ø‡§¶‡§ø ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ ‡§Æ‡•á‡§Ç ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à, ‡§§‡•ã ‡§¨‡§§‡§æ‡§è‡§Ç ‡§ï‡§ø ‡§â‡§∏ ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à, ‡§≤‡•á‡§ï‡§ø‡§® ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ ‡§∏‡•á ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•á‡§Ç‡•§
            3.  ‡§™‡•á‡§∂‡•á‡§µ‡§∞ ‡§î‡§∞ ‡§µ‡§ø‡§®‡§Æ‡•ç‡§∞ ‡§≤‡§π‡§ú‡•á ‡§ï‡§æ ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§
            4.  ‡§Ø‡§¶‡§ø ‡§â‡§§‡•ç‡§§‡§∞ ‡§≤‡§Ç‡§¨‡§æ ‡§π‡•à, ‡§§‡•ã ‡§â‡§∏‡•á ‡§õ‡•ã‡§ü‡•á ‡§™‡•à‡§∞‡§æ‡§ó‡•ç‡§∞‡§æ‡§´ ‡§Ø‡§æ ‡§¨‡•Å‡§≤‡•á‡§ü ‡§™‡•â‡§á‡§Ç‡§ü‡•ç‡§∏ ‡§Æ‡•á‡§Ç ‡§§‡•ã‡§°‡§º‡•á‡§Ç‡•§
            5.  ‡§∏‡•Ä‡§ß‡•á ‡§§‡•å‡§∞ ‡§™‡§∞ ‡§Ø‡§π ‡§® ‡§ï‡§π‡•á‡§Ç ‡§ï‡§ø "‡§Æ‡•á‡§∞‡•á ‡§™‡§æ‡§∏ ‡§ú‡§µ‡§æ‡§¨ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à"‡•§
            6.  ‡§Æ‡§æ‡§® ‡§≤‡•á‡§Ç ‡§ï‡§ø '‡§¨‡•à‡§Ç‡§ï' ‡§∂‡§¨‡•ç‡§¶ ‡§¨‡•à‡§Ç‡§ï ‡§ï‡§Æ‡•ç‡§Ø‡•Å‡§®‡§ø‡§ü‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§ï‡•ã ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§ú‡§¨ ‡§§‡§ï ‡§ï‡§ø ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§Ö‡§®‡•ç‡§Ø‡§•‡§æ ‡§® ‡§ï‡§π‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•ã‡•§

            ‡§™‡•ç‡§∞‡§æ‡§∏‡§Ç‡§ó‡§ø‡§ï ‡§¨‡•à‡§Ç‡§ï ‡§ï‡§Æ‡•ç‡§Ø‡•Å‡§®‡§ø‡§ü‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä:
            ${context}
            ---
            ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®: ${currentQuery}

            ‡§â‡§§‡•ç‡§§‡§∞ (‡§∏‡•ç‡§™‡§∑‡•ç‡§ü, ‡§∏‡§Ç‡§ï‡•ç‡§∑‡§ø‡§™‡•ç‡§§ ‡§î‡§∞ ‡§Æ‡§¶‡§¶‡§ó‡§æ‡§∞):`;
            useGeneralApi = false;

        } else {
            // --- NO CONTEXT FOUND ---
            useGeneralApi = true;
            prompt = `‡§Ü‡§™ '‡§¨‡•à‡§Ç‡§ï ‡§ï‡§Æ‡•ç‡§Ø‡•Å‡§®‡§ø‡§ü‡•Ä ‡§ö‡•à‡§ü‡§¨‡•â‡§ü' ‡§π‡•à‡§Ç, ‡§è‡§ï ‡§™‡•á‡§∂‡•á‡§µ‡§∞ ‡§î‡§∞ ‡§∏‡§π‡§æ‡§Ø‡§ï AI‡•§ ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡•á ‡§è‡§ï ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§™‡•Ç‡§õ‡§æ ‡§π‡•à ‡§ú‡•ã ‡§∏‡•Ä‡§ß‡•á ‡§§‡•å‡§∞ ‡§™‡§∞ ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§ø‡§è ‡§ó‡§è ‡§¨‡•à‡§Ç‡§ï ‡§ï‡§Æ‡•ç‡§Ø‡•Å‡§®‡§ø‡§ü‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§°‡•á‡§ü‡§æ ‡§∏‡•á ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§
            ‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂:
            1.  ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•á ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§ï‡§æ ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞, ‡§Ø‡§¶‡§ø ‡§∏‡§Ç‡§≠‡§µ ‡§π‡•ã ‡§§‡•ã, ‡§∏‡§Ç‡§ï‡•ç‡§∑‡•á‡§™ ‡§Æ‡•á‡§Ç ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•á‡§Ç‡•§
            2.  ‡§™‡•á‡§∂‡•á‡§µ‡§∞ ‡§î‡§∞ ‡§µ‡§ø‡§®‡§Æ‡•ç‡§∞ ‡§≤‡§π‡§ú‡•á ‡§ï‡§æ ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§
            3.  ‡§â‡§§‡•ç‡§§‡§∞ ‡§ï‡•á ‡§Ö‡§Ç‡§§ ‡§Æ‡•á‡§Ç, ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§¨‡§§‡§æ‡§è‡§Ç ‡§ï‡§ø ‡§Ü‡§™‡§ï‡§æ ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§´‡•ã‡§ï‡§∏ ‡§¨‡•à‡§Ç‡§ï ‡§ï‡§Æ‡•ç‡§Ø‡•Å‡§®‡§ø‡§ü‡•Ä ‡§≤‡•ã‡§® ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§™‡§∞ ‡§π‡•à‡•§
            4.  ‡§∏‡•Ä‡§ß‡•á ‡§§‡•å‡§∞ ‡§™‡§∞ ‡§Ø‡§π ‡§® ‡§ï‡§π‡•á‡§Ç ‡§ï‡§ø "‡§Æ‡•á‡§∞‡•á ‡§™‡§æ‡§∏ ‡§ú‡§µ‡§æ‡§¨ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à"‡•§ ‡§Ø‡§¶‡§ø ‡§Ü‡§™ ‡§â‡§§‡•ç‡§§‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§¶‡•á ‡§∏‡§ï‡§§‡•á, ‡§§‡•ã ‡§¨‡§§‡§æ‡§è‡§Ç ‡§ï‡§ø ‡§Ø‡§π ‡§Ü‡§™‡§ï‡•á ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û‡§§‡§æ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§∏‡•á ‡§¨‡§æ‡§π‡§∞ ‡§π‡•à ‡§î‡§∞ ‡§Ü‡§™ ‡§¨‡•à‡§Ç‡§ï ‡§ï‡§Æ‡•ç‡§Ø‡•Å‡§®‡§ø‡§ü‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§™‡§∞ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§
            5.  ‡§Æ‡§æ‡§® ‡§≤‡•á‡§Ç ‡§ï‡§ø '‡§¨‡•à‡§Ç‡§ï' ‡§∂‡§¨‡•ç‡§¶ ‡§¨‡•à‡§Ç‡§ï ‡§ï‡§Æ‡•ç‡§Ø‡•Å‡§®‡§ø‡§ü‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§ï‡•ã ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§ú‡§¨ ‡§§‡§ï ‡§ï‡§ø ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§Ö‡§®‡•ç‡§Ø‡§•‡§æ ‡§® ‡§ï‡§π‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•ã‡•§

            ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®: ${currentQuery}

            ‡§â‡§§‡•ç‡§§‡§∞ (‡§∏‡§Ç‡§ï‡•ç‡§∑‡§ø‡§™‡•ç‡§§ ‡§î‡§∞ ‡§Æ‡§¶‡§¶‡§ó‡§æ‡§∞, ‡§¨‡•à‡§Ç‡§ï ‡§ï‡§Æ‡•ç‡§Ø‡•Å‡§®‡§ø‡§ü‡•Ä ‡§´‡•ã‡§ï‡§∏ ‡§ï‡§æ ‡§â‡§≤‡•ç‡§≤‡•á‡§ñ ‡§ï‡§∞‡•á‡§Ç):`;
        }

        // --- API Call ---
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;
        try {
            const response = await fetch(API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: { temperature: 0.65, maxOutputTokens: 500 } // Slightly adjusted temp
                    // safetySettings: [...] // Add if needed
                }),
            });

            typingIndicator.remove();

            if (!response.ok) {
                const errorData = await response.json();
                console.error("API Error:", response.status, errorData);
                appendMessage(`‡§ï‡•ç‡§∑‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç, API ‡§∏‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§Ü ‡§∞‡§π‡•Ä ‡§π‡•à‡•§ (Code: ${response.status})`, "bot");
                displayErrorSuggestions(currentQuery); // Suggest questions on error
                return;
            }

            const js = await response.json();

            if (js.candidates && js.candidates[0]?.content?.parts?.[0]?.text) {
                const rawAnswer = js.candidates[0].content.parts[0].text.trim();
                // Create the message element first
                const messageElement = appendMessage("", "bot"); // Append empty div first
                // Use typeEffect, passing the element and the callback
                typeEffect(rawAnswer, messageElement, useGeneralApi ? () => displayErrorSuggestions(currentQuery) : null);

            } else {
                 // Handle blocked content or other issues
                 let reason = "‡§Ö‡§ú‡•ç‡§û‡§æ‡§§ ‡§ï‡§æ‡§∞‡§£";
                 if(js.promptFeedback?.blockReason) { reason = `‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä ‡§¨‡•ç‡§≤‡•â‡§ï (${js.promptFeedback.blockReason})`; }
                 else if (!js.candidates || js.candidates.length === 0) { reason = "API ‡§∏‡•á ‡§ï‡•ã‡§à ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä"; }
                 console.warn("API Response Issue:", reason, js);
                 appendMessage(`‡§ï‡•ç‡§∑‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç, ‡§Æ‡•à‡§Ç ‡§á‡§∏ ‡§∏‡§Æ‡§Ø ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞ ‡§™‡§æ ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Å‡•§ (${reason})`, "bot");
                 displayErrorSuggestions(currentQuery); // Suggest questions on failure
            }

        } catch (error) {
            typingIndicator.remove();
            console.error("Network/Fetch Error:", error);
            appendMessage("‡§ï‡•ç‡§∑‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç, ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§ï‡§®‡•á‡§ï‡•ç‡§∂‡§® ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§π‡•à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§¨‡§æ‡§¶ ‡§Æ‡•á‡§Ç ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§", "bot");
            // Suggest questions even on network error
            displayErrorSuggestions(currentQuery);
        }
    }

    /**
     * Animates text typing effect in a target HTML element and handles linkification.
     * @param {string} text - The plain text to type out.
     * @param {HTMLElement} targetElement - The HTML element where the text should be typed.
     * @param {Function | null} callback - Optional callback function to execute when typing is complete.
     */
    function typeEffect(text, targetElement, callback = null) {
        let i = 0;
        targetElement.innerHTML = '&nbsp;'; // Initial content for layout
        const interval = setInterval(() => {
            if (i < text.length) {
                // Append character by character using textContent to avoid HTML interpretation during typing
                targetElement.textContent = text.substring(0, i + 1);
                // Ensure scroll stays at bottom
                chatBox.scrollTop = chatBox.scrollHeight;
                i++;
            } else {
                clearInterval(interval);
                // ---- Linkify and finalize content ----
                const linkifiedHtml = linkify(text);
                targetElement.innerHTML = linkifiedHtml; // Set final HTML content with links
                // ---- Execute Callback ----
                if (typeof callback === 'function') {
                    // Slight delay for visual separation before callback action (like showing suggestions)
                    setTimeout(callback, 150);
                }
                 // Ensure scroll stays at bottom after final render
                 chatBox.scrollTo({ top: chatBox.scrollHeight, behavior: 'smooth' });
            }
        }, 25); // Typing speed (adjust as needed)
    }


    // Hide suggestions above input if user clicks outside
    document.addEventListener('click', function(event) {
        const isClickInsideInput = inputBox.contains(event.target);
        const isClickInsideSuggestions = suggestionsBox.contains(event.target);
        if (!isClickInsideInput && !isClickInsideSuggestions) {
            suggestionsBox.style.display = 'none';
        }
    });

    // Initial focus on input field
    // inputBox.focus(); // Consider if this is good UX on mobile

</script>

</body>
</html>
